---
pageTitle: 'Throttle Action Step'
title: 'Throttle'
description: 'Learn how to use the throttle step to control notification rate limiting and prevent subscriber fatigue'
---

The `throttle` step allows you to control the rate at which notifications are sent to subscribers. This helps prevent notification fatigue by limiting the number of messages sent within a specified time window.

## Example Usage

```tsx
await step.throttle('rate-limiter', async () => {
  return {
    limit: 5, // Maximum 5 notifications
    interval: '1 hour', // Within 1 hour
  };
});

await step.email('throttled-email', async () => {
  return {
    subject: 'Rate-limited notification',
    body: 'This email respects your notification preferences',
  };
});
```

## Throttle Step Configuration

| Property | Type | Required | Description |
| --- | --- | --- | --- |
| limit | number | Yes | The maximum number of notifications allowed within the time window |
| interval | string | Yes | The time window for the rate limit (e.g., '1 hour', '30 minutes', '1 day') |
| throttleKey | string | No | Custom key to group throttling by specific criteria |

<Callout type="info">
  If the throttle limit is exceeded, the workflow execution stops at the throttle step, and no subsequent steps are executed.
</Callout>

## Throttle Step Result

The throttle step returns information about the current throttle state:

| Property | Type          | Description                                        |
| -------- | ------------- | -------------------------------------------------- |
| allowed   | boolean       | Whether the notification is allowed to proceed |
| remaining | number        | Number of notifications remaining in the current window |
| resetTime | Date          | When the throttle window will reset |

## Using Throttle Results

You can use the throttle results to make decisions in your workflow:

```tsx
const throttleResult = await step.throttle('smart-throttle', async () => {
  return {
    limit: 3,
    interval: '2 hours',
  };
});

// The workflow automatically stops if throttle.allowed is false
// This code only runs if throttling allows it
await step.email('allowed-notification', async () => {
  return {
    subject: `Notification (${throttleResult.remaining} remaining)`,
    body: 'This notification passed the rate limit check',
  };
});
```

## Time Interval Formats

The throttle step supports various time interval formats:

```tsx
// Seconds
await step.throttle('seconds-throttle', async () => ({
  limit: 10,
  interval: '30 seconds' // or '30s'
}));

// Minutes
await step.throttle('minutes-throttle', async () => ({
  limit: 5,
  interval: '15 minutes' // or '15m'
}));

// Hours
await step.throttle('hours-throttle', async () => ({
  limit: 2,
  interval: '3 hours' // or '3h'
}));

// Days
await step.throttle('daily-throttle', async () => ({
  limit: 1,
  interval: '1 day' // or '1d'
}));

// Weeks
await step.throttle('weekly-throttle', async () => ({
  limit: 3,
  interval: '1 week' // or '1w'
}));

// Months
await step.throttle('monthly-throttle', async () => ({
  limit: 10,
  interval: '1 month' // or '1M'
}));
```

## Custom Throttle Keys

By default, throttling is applied per `subscriberId`. You can use custom throttle keys to group throttling by other criteria:

```tsx
// Throttle by user role
await step.throttle('role-based-throttle', async () => ({
  limit: payload.userRole === 'premium' ? 10 : 3,
  interval: '1 day',
  throttleKey: payload.userRole,
}));

// Throttle by notification category
await step.throttle('category-throttle', async () => ({
  limit: 5,
  interval: '1 hour',
  throttleKey: `category:${payload.category}`,
}));

// Throttle by geographic region
await step.throttle('region-throttle', async () => ({
  limit: 100,
  interval: '1 hour',
  throttleKey: `region:${payload.region}`,
}));
```

## Advanced Patterns

### Combining with Digest

```tsx
// First, check if we can send notifications
await step.throttle('hourly-limit', async () => ({
  limit: 1,
  interval: '1 hour',
}));

// If throttle allows, collect and send digest
const { events } = await step.digest('activity-digest', async () => ({
  amount: 30,
  unit: 'minutes',
}));

await step.email('digest-email', async () => ({
  subject: `Activity Summary (${events.length} events)`,
  body: render(<ActivityDigest events={events} />),
}));
```

### Priority-Based Throttling

```tsx
// Different limits based on message priority
await step.throttle('priority-throttle', async () => {
  const limits = {
    critical: { limit: 10, interval: '1 hour' },
    normal: { limit: 3, interval: '1 hour' },
    low: { limit: 1, interval: '1 day' },
  };
  
  return limits[payload.priority] || limits.normal;
});
```

### Multi-Level Throttling

```tsx
// Global throttle for all notifications
await step.throttle('global-throttle', async () => ({
  limit: 50,
  interval: '1 day',
  throttleKey: 'global',
}));

// Category-specific throttle
await step.throttle('category-throttle', async () => ({
  limit: 10,
  interval: '1 hour',
  throttleKey: `category:${payload.category}`,
}));

// User-specific throttle (default behavior)
await step.throttle('user-throttle', async () => ({
  limit: 5,
  interval: '1 hour',
}));
```

<Callout type="warn">
  Throttle limits are enforced in the order they appear in the workflow. If any throttle step blocks execution, subsequent steps (including other throttle steps) will not run.
</Callout>

## Error Handling

```tsx
try {
  await step.throttle('error-prone-throttle', async () => ({
    limit: payload.customLimit || 5,
    interval: payload.customInterval || '1 hour',
  }));
  
  await step.email('success-email', async () => ({
    subject: 'Operation successful',
    body: 'Your request was processed within rate limits',
  }));
} catch (error) {
  // Handle throttle configuration errors
  await step.email('error-email', async () => ({
    subject: 'Configuration Error',
    body: 'There was an issue with the throttle configuration',
  }));
}
```

<Callout type="info">
  Changes to throttle configuration after workflow deployment only affect new executions. Existing throttle windows continue with their original settings until they expire.
</Callout>

## Best Practices

1. **Choose appropriate limits**: Set limits based on your users' expectations and your system's capacity
2. **Use meaningful throttle keys**: Group related notifications together with descriptive throttle keys
3. **Consider user segments**: Different user types may need different rate limits
4. **Monitor throttle effectiveness**: Track how often notifications are blocked to optimize your limits
5. **Combine with other features**: Use throttle with digest and delay steps for sophisticated notification strategies

## Common Use Cases

### Marketing Campaigns
```tsx
await step.throttle('marketing-limit', async () => ({
  limit: 2,
  interval: '1 week',
  throttleKey: 'marketing',
}));
```

### Security Alerts
```tsx
await step.throttle('security-limit', async () => ({
  limit: 5,
  interval: '1 hour',
  throttleKey: 'security',
}));
```

### Social Notifications
```tsx
await step.throttle('social-limit', async () => ({
  limit: 10,
  interval: '1 day',
  throttleKey: `social:${payload.activityType}`,
}));
```

### System Alerts
```tsx
await step.throttle('system-limit', async () => ({
  limit: 1,
  interval: '15 minutes',
  throttleKey: `system:${payload.alertType}`,
}));
```